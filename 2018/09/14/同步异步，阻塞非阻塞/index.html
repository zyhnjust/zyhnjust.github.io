<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>同步异步，阻塞非阻塞 | Tech</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="关于这两个概念， 感觉很难理解。 后来查找了一些文档， 一下是自己的理解。">
<meta name="keywords" content="架构">
<meta property="og:type" content="article">
<meta property="og:title" content="同步异步，阻塞非阻塞">
<meta property="og:url" content="http://yoursite.com/2018/09/14/同步异步，阻塞非阻塞/index.html">
<meta property="og:site_name" content="Tech">
<meta property="og:description" content="关于这两个概念， 感觉很难理解。 后来查找了一些文档， 一下是自己的理解。">
<meta property="og:locale" content="default">
<meta property="og:image" content="d:/developer/blog/zyhnjust.github.io/source/_posts/同步异步，阻塞非阻塞/clipboard1.png">
<meta property="og:image" content="http://yoursite.com/2018/09/14/同步异步，阻塞非阻塞/clipboard1.png">
<meta property="og:image" content="d:/developer/blog/zyhnjust.github.io/source/_posts/同步异步，阻塞非阻塞/clipboard2.png">
<meta property="og:image" content="http://yoursite.com/2018/09/14/同步异步，阻塞非阻塞/clipboard2.png">
<meta property="og:image" content="d:/developer/blog/zyhnjust.github.io/source/_posts/同步异步，阻塞非阻塞/clipboard3.png">
<meta property="og:image" content="http://yoursite.com/2018/09/14/同步异步，阻塞非阻塞/clipboard3.png">
<meta property="og:image" content="d:/developer/blog/zyhnjust.github.io/source/_posts/同步异步，阻塞非阻塞/clipboard4.png">
<meta property="og:image" content="http://yoursite.com/2018/09/14/同步异步，阻塞非阻塞/clipboard4.png">
<meta property="og:image" content="d:/developer/blog/zyhnjust.github.io/source/_posts/同步异步，阻塞非阻塞/clipboard5.png">
<meta property="og:image" content="http://yoursite.com/2018/09/14/同步异步，阻塞非阻塞/clipboard5.png">
<meta property="og:updated_time" content="2018-10-06T09:39:23.922Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="同步异步，阻塞非阻塞">
<meta name="twitter:description" content="关于这两个概念， 感觉很难理解。 后来查找了一些文档， 一下是自己的理解。">
<meta name="twitter:image" content="d:/developer/blog/zyhnjust.github.io/source/_posts/同步异步，阻塞非阻塞/clipboard1.png">
  
    <link rel="alternate" href="/atom.xml" title="Tech" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Tech</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-同步异步，阻塞非阻塞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/14/同步异步，阻塞非阻塞/" class="article-date">
  <time datetime="2018-09-13T23:19:14.000Z" itemprop="datePublished">2018-09-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/面试/">面试</a>►<a class="article-category-link" href="/categories/面试/java/">java</a>►<a class="article-category-link" href="/categories/面试/java/IO/">IO</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      同步异步，阻塞非阻塞
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
	    
<div id="toc">
  
</div>

        <p>关于这两个概念， 感觉很难理解。 后来查找了一些文档， 一下是自己的理解。 </p>
<a id="more"></a> 
<p>要理解这两个概念， 首先应该以每个场景抽象出解释， 然后对应常用的情况进行落地，这样应该就比较扎实了。<br>理解到最后， 其实概念本身显得不是那么重要的， 而什么重要呢， 就是现实中应用的场景重要。 </p>
<ol>
<li>从场景入手<br>理解这几个概念不能离开问题的场景以及主体， 也离不开阶段。 </li>
</ol>
<ul>
<li>比如抽象一个简单的场景， A 去查询B。 B 可以是文件， 网络， 或者别的资源。 A可以理解是线程。 </li>
<li>所谓阻塞非阻塞， 是针对调用方而言的， 也就是A。 如果A需要等在这里， 就是阻塞的。 如果A可以去做别的， 就是非阻塞的。 而至于A是过会过来轮询拿到结果呢， 还是B有了结果通知老张可以拿呢， A都是非阻塞的。 </li>
<li><p>注意一点， 如果B通知了A， A回来拿结果， 直接就拿走了。 对于A而言这个过程又是同步的。 所以我们说同步异步要看哪个阶段还是总体。 一般而言我们说的是整个过程。 </p>
</li>
<li><p>同步异步， 说的是B。 这点可能还需要思考。 是B还是这个过程。对于B而言， 如果A发了消息等在这里， 或者过段来查询， B 都是同步的。 而如果A发了消息就回去了， 要等B的通知。 那么就是异步的。 </p>
</li>
</ul>
<p>2  常用</p>
<ul>
<li>同步阻塞。 如果A查询B， A 等着直到B 返回结果。 这就是常用的同步阻塞。 </li>
<li>异步非阻塞。 如果A返回， 等着B的通知， 这就是异步非阻塞。 </li>
<li>同步非阻塞。 如果A返回， 然后不断查询B 是否可以拿结果， 是同步非阻塞。 </li>
</ul>
<p>3 网络上的一个例子很形象。<br>from 知乎 <a href="https://www.zhihu.com/question/19732473" target="_blank" rel="noopener">https://www.zhihu.com/question/19732473</a><br>老张爱喝茶，废话不说，煮开水。<br>出场人物：老张，水壶两把（普通水壶，简称水壶；会响的水壶，简称响水壶）。</p>
<ul>
<li>1 老张把水壶放到火上，立等水开。（同步阻塞）</li>
<li>老张觉得自己有点傻</li>
<li>2 老张把水壶放到火上，去客厅看电视，时不时去厨房看看水开没有。（同步非阻塞）</li>
<li>老张还是觉得自己有点傻，于是变高端了，买了把会响笛的那种水壶。水开之后，能大声发出嘀~~~~的噪音。</li>
<li>3 老张把响水壶放到火上，立等水开。（异步阻塞）</li>
<li>老张觉得这样傻等意义不大</li>
<li>4 老张把响水壶放到火上，去客厅看电视，水壶响之前不再去看它了，响了再去拿壶。（异步非阻塞）</li>
<li><p>老张觉得自己聪明了。</p>
</li>
<li><p>所谓同步异步，只是对于水壶而言。普通水壶，同步；响水壶，异步。虽然都能干活，但响水壶可以在自己完工之后，提示老张水开了。这是普通水壶所不能及的。- 同步只能让调用者去轮询自己（情况2中），造成老张效率的低下。</p>
</li>
<li>所谓阻塞非阻塞，仅仅对于老张而言。立等的老张，阻塞；看电视的老张，非阻塞- 情况1和情况3中老张就是阻塞的，媳妇喊他都不知道。虽然3中响水壶是异步的，可对于立等的老张没有太大的意义。所以一般异步是配合非阻塞使用的，这样才能发挥异步的效用。</li>
<li>——来源网络，作者不明。</li>
</ul>
<ol start="3">
<li>再深一步cpu层面， 线程层面， 程序员层面</li>
</ol>
<p>这几个概念，上面不少答案已经写得很清楚了。这里我结合自己的理解，简单地聊一下为什么这几个概念容易混淆。如果有错误之处，恳请批评指正。<br>我认为同步、异步、阻塞、非阻塞，是分3个层次的：</p>
<ul>
<li>CPU层次；</li>
<li>线程层次；</li>
<li>程序员感知层次。</li>
</ul>
<p>这几个概念之所以容易混淆，是因为没有分清楚是在哪个层次进行讨论。</p>
<ul>
<li>CPU层次<br>在CPU层次，或者说操作系统进行IO和任务调度的层次，现代操作系统通常使用异步非阻塞方式进行IO（有少部分IO可能会使用同步非阻塞轮询），即发出IO请求之后，并不等待IO操作完成，而是继续执行下面的指令（非阻塞），IO操作和CPU指令互不干扰（异步），最后通过中断的方式来通知IO操作完成结果。</li>
<li>线程层次 – 一般说到这个层次可以<br>在线程层次，或者说操作系统调度单元的层次，操作系统为了减轻程序员的思考负担，将底层的异步非阻塞的IO方式进行封装，把相关系统调用（如read，write等）以同步的方式展现出来。然而，同步阻塞的IO会使线程挂起，同步非阻塞的IO会消耗CPU资源在轮询上。为了解决这一问题，就有3种思路：</li>
</ul>
<p>多线程（同步阻塞）；<br>IO多路复用（select，poll，epoll）（同步非阻塞，严格地来讲，是把阻塞点改变了位置）；<br>直接暴露出异步的IO接口，如kernel-aio和IOCP（异步非阻塞）。</p>
<ul>
<li>程序员感知层次<br>在Linux中，上面提到的第2种思路用得比较广泛，也是比较理想的解决方案。然而，直接使用select之类的接口，依然比较复杂，所以各种库和框架百花齐放，都试图对IO多路复用进行封装。此时，库和框架提供的API又可以选择是以同步的方式还是异步的方式来展现。如python的asyncio库中，就通过协程，提供了同步阻塞式的API；如node.js中，就通过回调函数，提供了异步非阻塞式的API。<br>总结<br>因此，我们在讨论同步、异步、阻塞、非阻塞时，必须先明确是在哪个层次进行讨论。比如node.js，我们可以说她在程序员感知层次提供了异步非阻塞的API，也可以说在Linux下，她在线程层次以同步非阻塞的epoll来实现。</li>
</ul>
<p>所谓同步，是指调用协议中结果在调用完成时返回，这样调用的过程中参与双方都处于一个状态同步的过程。<br>而异步，是指调用方发出请求就立即返回，请求甚至可能还没到达接收方，比如说放到了某个缓冲区中，等待对方取走或者第三方转交；而结果，则通过接收方主动推送，或调用方轮询来得到。– 调用方轮询的时候–》 </p>
<ol start="4">
<li>在网络编程的理解， 主要是内核态和用户态加入， 这个也是这个问题提出的重要场景</li>
</ol>
<p>Unix网络编程第一本书， 第六章。 </p>
<p>阻塞IO<br><img src="D:\developer\blog\zyhnjust.github.io\source\_posts\同步异步，阻塞非阻塞\clipboard1.png" alt="image"><br><img src="clipboard1.png" alt="image"></p>
<p>非阻塞 IO 所以阻塞非阻塞还是看调用方， 是否可以作别的。 还是<br><img src="D:\developer\blog\zyhnjust.github.io\source\_posts\同步异步，阻塞非阻塞\clipboard2.png" alt="image"><br><img src="clipboard2.png" alt="image"></p>
<p>IO 复用<br>这里呢对于每个而言其实都是阻塞的， 但是对整个事情而来可以说是非阻塞的。<br><img src="D:\developer\blog\zyhnjust.github.io\source\_posts\同步异步，阻塞非阻塞\clipboard3.png" alt="image"><br><img src="clipboard3.png" alt="image"></p>
<ul>
<li>信号驱动IO 模型<br>第一部分没有阻塞。 内核就去准备了。<br>准备好之后内核通知应用说准备好了。 -》 这里对调用方是异步。<br>然后应用进程去读， 是同步的， 但是这个时候数据准备好了已经。 </li>
</ul>
<p><img src="D:\developer\blog\zyhnjust.github.io\source\_posts\同步异步，阻塞非阻塞\clipboard4.png" alt="image"><br><img src="clipboard4.png" alt="image"></p>
<ul>
<li>异步IO 模型</li>
<li>异步IO 就是应用程序初始一个request， 然后内核会准备数据， 并且把数据拷贝到用户空间， 然后通知应用程序。<br>和信号驱动io的区别， 信号驱动是告诉你可以启动一个IO 操作， 异步则是告诉你做完了。 </li>
</ul>
<p><img src="D:\developer\blog\zyhnjust.github.io\source\_posts\同步异步，阻塞非阻塞\clipboard5.png" alt="image"><br><img src="clipboard5.png" alt="image"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/09/14/同步异步，阻塞非阻塞/" data-id="cjmxh1ee9000zuwnk1934b4yt" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/架构/">架构</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/09/17/NIO-question/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          NIO_question
        
      </div>
    </a>
  
  
    <a href="/2018/09/12/java并发概述/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">java并发概述</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AI/">AI</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/AI/ML/">ML</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/AI/读书笔记/">读书笔记</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/arch/">arch</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/arch/分布式/">分布式</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/network/">network</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/面试/">面试</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/面试/db/">db</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/面试/java/">java</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/面试/java/IO/">IO</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/面试/java/JVM/">JVM</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/面试/java/basic/">basic</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/面试/java/并发/">并发</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/面试/大数据/">大数据</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/面试/大数据/redis/">redis</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/面试/架构/">架构</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/面试/架构/微服务/">微服务</a></li></ul></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AI/">AI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IO/">IO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/arch/">arch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/db/">db</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jvm/">jvm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/microservice/">microservice</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vertx/">vertx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式事务/">分布式事务</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/并发/">并发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/架构/">架构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/读书笔记/">读书笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/面试/">面试</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/AI/" style="font-size: 10px;">AI</a> <a href="/tags/IO/" style="font-size: 10px;">IO</a> <a href="/tags/arch/" style="font-size: 10px;">arch</a> <a href="/tags/db/" style="font-size: 10px;">db</a> <a href="/tags/http/" style="font-size: 10px;">http</a> <a href="/tags/java/" style="font-size: 20px;">java</a> <a href="/tags/jvm/" style="font-size: 10px;">jvm</a> <a href="/tags/microservice/" style="font-size: 10px;">microservice</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/vertx/" style="font-size: 10px;">vertx</a> <a href="/tags/分布式事务/" style="font-size: 10px;">分布式事务</a> <a href="/tags/并发/" style="font-size: 10px;">并发</a> <a href="/tags/架构/" style="font-size: 10px;">架构</a> <a href="/tags/读书笔记/" style="font-size: 10px;">读书笔记</a> <a href="/tags/面试/" style="font-size: 20px;">面试</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/10/06/读书笔记GoodDataandMachineLearning/">读书笔记GoodDataandMachineLearning</a>
          </li>
        
          <li>
            <a href="/2018/10/05/关于机器学习流程以及几个度量的理解/">关于机器学习流程以及几个度量的理解</a>
          </li>
        
          <li>
            <a href="/2018/09/29/Http-time-wait状态/">Http_time_wait状态</a>
          </li>
        
          <li>
            <a href="/2018/09/29/二段式，三段式和Paxos/">二段式，三段式和Paxos</a>
          </li>
        
          <li>
            <a href="/2018/09/29/kubnetes-notes/">kubnetes_notes</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 hzhang<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="http://libs.baidu.com/jquery/2.1.1/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



<!-- 站内搜索-Swiftype -->
<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','sC-iNFrvTTNtiXEVNwo1','2.0.0');
</script>
  </div>
</body>
</html>